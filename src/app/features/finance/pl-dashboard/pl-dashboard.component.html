<div class="dashboard-container" [class.disabled-content]="isDashboardLoading">
    <div class="page-header">
        <h1 class="mat-headline-4">Profit & Loss Dashboard</h1>
        <p class="subtitle">Financial overview and key performance metrics.</p>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <mat-card class="stat-card income">
            <mat-card-header>
                <div mat-card-avatar class="icon-bg success">
                    <mat-icon>trending_up</mat-icon>
                </div>
                <mat-card-title>Total Income</mat-card-title>
                <mat-card-subtitle>Current Period</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <h2 class="stat-value">₹{{ totalIncome | number:'1.2-2' }}</h2>
                <span class="trend up"><mat-icon>arrow_upward</mat-icon> 12% vs last month</span>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card expense">
            <mat-card-header>
                <div mat-card-avatar class="icon-bg warn">
                    <mat-icon>trending_down</mat-icon>
                </div>
                <mat-card-title>Total Expenses</mat-card-title>
                <mat-card-subtitle>Current Period</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <h2 class="stat-value">₹{{ totalExpenses | number:'1.2-2' }}</h2>
                <span class="trend down"><mat-icon>arrow_downward</mat-icon> 5% vs last month</span>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card profit">
            <mat-card-header>
                <div mat-card-avatar class="icon-bg primary">
                    <mat-icon>account_balance_wallet</mat-icon>
                </div>
                <mat-card-title>Net Profit</mat-card-title>
                <mat-card-subtitle>Income - Expenses</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <h2 class="stat-value" [class.negative]="netProfit < 0">₹{{ netProfit | number:'1.2-2' }}</h2>
                <mat-progress-bar mode="determinate" [value]="profitMargin"></mat-progress-bar>
                <span class="margin-label">Margin: {{ profitMargin | number:'1.1-1' }}%</span>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card receivables">
            <mat-card-header>
                <div mat-card-avatar class="icon-bg indigo">
                    <mat-icon>call_received</mat-icon>
                </div>
                <mat-card-title>Total Receivables</mat-card-title>
                <mat-card-subtitle>From Customers</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <h2 class="stat-value" [class.text-advance]="totalReceivables < 0">
                    ₹{{ (totalReceivables < 0 ? -totalReceivables : totalReceivables) | number:'1.2-2' }}
                    <span *ngIf="totalReceivables < 0" class="adv-suffix">(Adv)</span>
                </h2>
                <button mat-button color="primary" routerLink="/app/finance/customers/outstanding">View Tracker</button>
            </mat-card-content>
        </mat-card>

        <mat-card class="stat-card payables">
            <mat-card-header>
                <div mat-card-avatar class="icon-bg orange">
                    <mat-icon>call_made</mat-icon>
                </div>
                <mat-card-title>Total Payables</mat-card-title>
                <mat-card-subtitle>To Suppliers</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <h2 class="stat-value" [class.text-advance]="totalPayables < 0">
                    ₹{{ (totalPayables < 0 ? -totalPayables : totalPayables) | number:'1.2-2' }}
                    <span *ngIf="totalPayables < 0" class="adv-suffix">(Adv)</span>
                </h2>
                <button mat-button color="warn" routerLink="/app/finance/suppliers/dues">View Dues</button>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Charts Section Placeholder -->
    <div class="charts-grid">
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Monthly Trends</mat-card-title>
            </mat-card-header>
            <mat-card-content class="chart-content">
                <div class="chart-wrapper" *ngIf="barChartData.labels && barChartData.labels.length > 0">
                    <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'">
                    </canvas>
                </div>
                <div class="placeholder-chart" *ngIf="!barChartData.labels || barChartData.labels.length === 0">
                    <mat-icon>bar_chart</mat-icon>
                    <p>No trend data available for this period.</p>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Expense Breakdown</mat-card-title>
            </mat-card-header>
            <mat-card-content class="chart-content">
                <div class="chart-wrapper" *ngIf="pieChartData.datasets[0].data.length > 0">
                    <canvas baseChart [data]="pieChartData" [options]="chartOptions" [type]="'pie'">
                    </canvas>
                </div>
                <div class="placeholder-chart" *ngIf="pieChartData.datasets[0].data.length === 0">
                    <mat-icon>pie_chart</mat-icon>
                    <p>No expense data available for this period.</p>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Top Customers Section -->
    <div class="charts-grid secondary" style="margin-top: 24px; grid-template-columns: 1fr;">
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Top 5 Customers by Outstanding Balance</mat-card-title>
            </mat-card-header>
            <mat-card-content class="chart-content">
                <div class="chart-wrapper" *ngIf="topCustomersData.labels && topCustomersData.labels.length > 0">
                    <canvas baseChart 
                            [data]="topCustomersData" 
                            [options]="horizontalBarOptions" 
                            [type]="'bar'">
                    </canvas>
                </div>
                <div class="placeholder-chart" *ngIf="!topCustomersData.labels || topCustomersData.labels.length === 0">
                    <mat-icon>people</mat-icon>
                    <p>No outstanding customer data available.</p>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>
