<div class="stock-container">
  <div class="header-section">
    <h2>Current Inventory Status</h2>
    <mat-form-field appearance="outline" class="search-box">
      <mat-label>Search Product</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="e.g. Fan, LED..." #input>
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <div class="alert-grid" *ngIf="lowStockCount > 0">
    <div class="alert-card low-stock-warning">
      <div class="alert-info-wrapper">
        <mat-icon>warning</mat-icon>
        <div class="alert-content">
          <span class="alert-title">Low Stock Alert</span>
          <span class="alert-desc">Attention! {{lowStockCount}} items are running below 10 units threshold.</span>
        </div>
      </div>
      
      <button mat-flat-button color="warn" class="refill-btn" (click)="navigateToPO()">
        <mat-icon>shopping_cart</mat-icon>
        REFILL NOW
      </button>
    </div>
  </div>

  <div class="table-responsive mat-elevation-z8">
    
    <div class="loading-shade" *ngIf="isLoadingResults">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <div class="table-container">
      <table mat-table [dataSource]="stockDataSource" matSort>

        <ng-container matColumnDef="productName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Product Name </th>
          <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
        </ng-container>

        <ng-container matColumnDef="totalReceived">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Total Received </th>
          <td mat-cell *matCellDef="let element"> {{element.totalQty}} </td>
        </ng-container>

        <ng-container matColumnDef="availableStock">
          <th mat-header-cell *matHeaderCellDef> Available Stock </th>
          <td mat-cell *matCellDef="let element"> 
            <span [ngClass]="element.totalQty < 10 ? 'low-stock' : 'good-stock'">
              {{element.totalQty}} {{element.unit}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="unitRate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Valued At </th>
          <td mat-cell *matCellDef="let element"> {{element.lastRate | currency:'INR'}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.low-stock-row]="row.totalQty < 10"></tr>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4" style="padding: 20px; text-align: center;">
            <span *ngIf="!isLoadingResults">No data matching "{{input.value}}"</span>
          </td>
        </tr>
      </table>
    </div>

    <mat-paginator [length]="resultsLength" 
                   [pageSize]="10" 
                   [pageSizeOptions]="[5, 10, 25, 100]" 
                   aria-label="Select page of stock">
    </mat-paginator>
  </div>

  <div class="summary-footer">
    <div class="summary-card">
      <div class="summary-label">Total Inventory Value</div>
      <div class="summary-value">{{ totalInventoryValue | currency:'INR' }}</div>
    </div>
  </div>
</div>