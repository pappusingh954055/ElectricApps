<div class="print-wrapper">
  
  <!-- Content Scrollable Area -->
  <div mat-dialog-content class="print-content">
      
      <div class="header">
          <div class="logo-section">
            <img *ngIf="companyInfo?.logoUrl" [src]="getImgUrl(companyInfo?.logoUrl)" class="company-logo" alt="Logo">
            <mat-icon *ngIf="!companyInfo?.logoUrl" class="logo-icon">inventory_2</mat-icon>
            <div class="company-name">
              <h1>{{companyInfo?.name || 'ELECTRIC INVENTORY'}}</h1>
              <div *ngIf="companyInfo?.address" class="company-address">
                {{companyInfo?.address?.addressLine1}}, 
                {{companyInfo?.address?.addressLine2 ? companyInfo?.address?.addressLine2 + ', ' : ''}}
                {{companyInfo?.address?.city}}, {{companyInfo?.address?.state}} - {{companyInfo?.address?.pinCode}}
              </div>
              <div class="company-contact">
                Contact: {{companyInfo?.primaryPhone}} | Email: {{companyInfo?.primaryEmail}}
              </div>
            </div>
          </div>
          <div class="doc-title">
            <h2>{{ data?.status === 'Received' ? 'TAX INVOICE' : (data?.headerTitle || 'BILL OF SUPPLY') }}</h2>
          </div>
      </div>
  
      <div class="po-info-card">
          <div class="info-row">
              <div class="info-group">
                  <label>PO Number</label>
                  <span>{{data?.poNumber || 'N/A'}}</span>
              </div>
              <div class="info-group">
                  <label>Date</label>
                  <span>{{data?.poDate | date:'dd MMM yyyy'}}</span>
              </div>
              <div class="info-group">
                  <label>Supplier</label>
                  <span>{{data?.supplierName || 'Unknown'}}</span>
              </div>
          </div>
      </div>
  
      <div class="table-container">
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-product">Product Description</th>
                    <th class="col-qty text-center">Qty</th>
                    <th class="col-rate text-right">Rate</th>
                    <th class="col-total text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of data?.items">
                    <td>{{item.productName}}</td>
                    <td class="text-center">{{item.qty}}</td>
                    <td class="text-right">{{item.rate | currency:'INR':'':'1.2-2'}}</td>
                    <td class="text-right">{{item.total | currency:'INR':'':'1.2-2'}}</td>
                </tr>
            </tbody>
        </table>
      </div>

      <!-- Invoice Summary (Moved outside table for better right-alignment) -->
      <div class="invoice-summary">
          <div class="summary-row">
              <span class="label">Sub Total</span>
              <span class="value">{{(data?.subTotal || 0) | currency:'INR':'':'1.2-2'}}</span>
          </div>
          <div class="summary-row">
              <span class="label">Total Tax</span>
              <span class="value">{{(data?.totalTax || 0) | currency:'INR':'':'1.2-2'}}</span>
          </div>
          <div class="summary-row grand-total">
              <span class="label">Grand Total</span>
              <span class="value">{{(data?.grandTotal || 0) | currency:'INR':'':'1.2-2'}}</span>
          </div>
      </div>
  </div>

  <!-- Sticky Footer Actions -->
  <div mat-dialog-actions align="end" class="footer-actions no-print">
      <button mat-stroked-button color="warn" (click)="close()">Cancel</button>
      
      <!-- Logic Update: 
           1. If Mode is PRINT OR (Status is Received) -> Show Print Button
           2. If Mode is VIEW OR (Status is Received AND Mode is PRINT) -> Show Download Button
      -->

      <!-- Download Button: Visible if Mode is VIEW OR (Status is Received AND Mode is PRINT) -->
      <button *ngIf="data?.mode === 'VIEW' || (data?.status === 'Received' && data?.mode === 'PRINT')" 
              mat-flat-button color="accent" (click)="downloadPDF()" [disabled]="isLoading">
        <mat-icon *ngIf="!isLoading">file_download</mat-icon> 
        <mat-spinner *ngIf="isLoading" diameter="20" style="display:inline-block; margin-right: 8px; vertical-align: middle;"></mat-spinner>
        {{ isLoading ? 'Downloading...' : 'Download PDF' }}
      </button>

      <!-- Print Button: Visible if Mode is PRINT -->
      <button *ngIf="data?.mode === 'PRINT'" mat-flat-button color="primary" (click)="print()">
        <mat-icon>print</mat-icon> Print Now
      </button>
  </div>
</div>
