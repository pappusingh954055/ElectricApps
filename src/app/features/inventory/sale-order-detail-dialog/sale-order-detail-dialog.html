<div class="dialog-container">
  
  <!-- Header -->
  <div class="header-p">
    <div class="company-header-group">
      <img *ngIf="companyInfo?.logoUrl" [src]="getImgUrl(companyInfo?.logoUrl)" class="dialog-logo" alt="Logo">
      <div class="company-text">
        <h1>{{companyInfo?.name || 'ELECTRIC INVENTORY'}}</h1>
        <div class="meta-row" *ngIf="companyInfo?.address">
          {{companyInfo?.address?.addressLine1}}, {{companyInfo?.address?.city}} - {{companyInfo?.address?.pinCode}}
        </div>
        <div class="meta-row">
          Ph: {{companyInfo?.primaryPhone}} | {{companyInfo?.primaryEmail}}
        </div>
      </div>
    </div>

    <div class="order-title-group">
      <h2>ORDER #{{data.soNumber || data.SONumber}}</h2>
      <span class="status-pill" [ngClass]="(data.status || data.Status)?.toLowerCase()">{{data.status || data.Status}}</span>
    </div>

    <button mat-icon-button mat-dialog-close class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Scrollable Content -->
  <div mat-dialog-content class="content-body">
    
    <!-- Info Grid -->
    <div class="info-card">
      <div class="info-group">
        <label>Customer Name</label>
        <div class="value">{{(data.customerName || data.CustomerName || data.customer?.customerName || data.customer?.name || data.name || data.Name) || 'N/A'}}</div>
      </div>
      <div class="info-group">
        <label>Order Date</label>
        <div class="value">{{(data.soDate || data.SODate) | date:'dd MMM yyyy'}}</div>
      </div>
      <div class="info-group">
        <label>Current Status</label>
        <div class="value status-badge" [ngClass]="(data.status || data.Status)?.toLowerCase()">{{data.status || data.Status}}</div>
      </div>
    </div>

    <!-- Items Table -->
    <div class="items-table-container">
      <table class="items-table">
        <thead>
          <tr>
            <th class="col-idx text-center">#</th>
            <th class="col-product">Product Name</th>
            <th class="col-qty text-center">Qty</th>
            <th class="col-rate text-right">Rate</th>
            <th class="col-disc text-center">Disc</th>
            <th class="col-gst text-center">GST (%)</th>
            <th class="col-total text-right">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of data.items; let i = index">
            <td class="col-idx text-center text-muted">{{i + 1}}</td>
            <td class="col-product">{{item.productName || item.ProductName}}</td>
            <td class="col-qty text-center">
                <div class="qty-val">{{item.qty || item.Qty}}</div>
                <div class="unit-val">{{item.unit || item.Unit || 'Nos'}}</div>
            </td>
            <td class="col-rate text-right">{{(item.rate || item.Rate) | currency:'INR':'symbol':'1.0-2'}}</td>
            <td class="col-disc text-center">{{item.discountPercent || item.DiscountPercent || item.discount || item.Discount || 0}}%</td>
            <td class="col-gst text-center">{{item.gstPercent || item.GSTPercent || item.gst || item.GST || item.tax || item.Tax || 0}}%</td>
            <td class="col-total text-right">{{(item.total || item.Total || ((item.qty || item.Qty) * (item.rate || item.Rate))) | currency:'INR':'symbol':'1.0-2'}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Summary Section -->
    <div class="invoice-summary">
        <div class="summary-row">
            <span class="label">Sub Total</span>
            <span class="value">{{((data.subTotal || data.SubTotal) || 0) | currency:'INR':'symbol':'1.2-2'}}</span>
        </div>
        <div class="summary-row">
            <span class="label">Total Tax</span>
            <span class="value">{{((data.totalTax || data.TotalTax) || 0) | currency:'INR':'symbol':'1.2-2'}}</span>
        </div>
        <div class="summary-row grand-total">
            <span class="label">Grand Total</span>
            <span class="value">{{((data.grandTotal || data.GrandTotal) || 0) | currency:'INR':'symbol':'1.2-2'}}</span>
        </div>
    </div>

  </div>

  <!-- Footer Actions -->
  <div mat-dialog-actions class="dialog-actions">
    <button mat-raised-button color="primary" (click)="print()">
      <mat-icon>print</mat-icon> Print
    </button>
    <button mat-raised-button mat-dialog-close color="warn">Close</button>
  </div>

</div>