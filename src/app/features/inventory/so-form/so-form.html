<mat-card>
  <form [formGroup]="soForm">
    <div class="form-grid">
      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>Customer *</mat-label>
        <input matInput formControlName="customerId">
      </mat-form-field>

      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>SO Date</mat-label>
        <input matInput type="date" formControlName="date">
      </mat-form-field>
    </div>

    <div class="add-item-container">
      <button mat-flat-button class="bg-cyan" type="button" (click)="addRow()">
        <mat-icon>add</mat-icon>
        Add Item
      </button>
    </div>

    <div formArrayName="items" class="items-section">
      <div class="item-row" *ngFor="let row of items.controls; let i = index" [formGroupName]="i">
        
        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Product</mat-label>
          <mat-select formControlName="productId" (selectionChange)="onProductChange(i)">
            <mat-option *ngFor="let p of products" [value]="p.id">{{ p.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Qty</mat-label>
          <input matInput type="number" formControlName="qty" (input)="updateTotal(i)">
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Unit</mat-label>
          <input matInput formControlName="unit" readonly>
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Price</mat-label>
          <input matInput formControlName="price" readonly>
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Disc %</mat-label>
          <input matInput type="number" formControlName="discountPercent" (input)="updateTotal(i)">
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>GST %</mat-label>
          <input matInput type="number" formControlName="gstPercent" (input)="updateTotal(i)">
        </mat-form-field>

        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-label>Total</mat-label>
          <input matInput formControlName="total" readonly>
        </mat-form-field>

        <button mat-icon-button type="button" class="bg-rose delete-btn" (click)="removeItem(i)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <div class="po-footer" *ngIf="items.length">
      <div class="po-grand-total">Grand Total: â‚¹ {{ grandTotal }}</div>     
        <button mat-flat-button class="bg-spring-green" type="button" (click)="SaveDraft()">
          <mat-icon>save</mat-icon>
          Save Draft
        </button>
        
        <button mat-flat-button class="bg-cyan" type="button" (click)="SaveSo()">
          <mat-icon>check_circle</mat-icon>
          Save SO
        </button>   
    </div>
  </form>
</mat-card>