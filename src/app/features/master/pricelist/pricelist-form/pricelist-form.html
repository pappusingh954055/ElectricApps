<div class="master-container">
  <form [formGroup]="priceListForm">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div class="actions ms-auto">
        <form-footer [loading]="loading" (save)="onSave()" [saveLabel]="isEditMode ? 'Update' : 'Save'" (cancel)="onCancel()"></form-footer>
      </div>
    </div>

    <div class="header-form-card shadow-sm border-top border-primary border-3">
      <div class="header-grid">
        <mat-form-field appearance="outline"><mat-label>Price List Name</mat-label><input matInput formControlName="name"></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Price Type</mat-label><mat-select formControlName="priceType"><mat-option value="SALES">Sales</mat-option></mat-select></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Apply to Group</mat-label><mat-select formControlName="applicableGroup"><mat-option value="ALL">All</mat-option></mat-select></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Price List Code</mat-label><input matInput formControlName="code"></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Valid From</mat-label><input matInput [matDatepicker]="p1" formControlName="validFrom"><mat-datepicker-toggle matSuffix [for]="p1"></mat-datepicker-toggle><mat-datepicker #p1></mat-datepicker></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Valid To</mat-label><input matInput [matDatepicker]="p2" formControlName="validTo"><mat-datepicker-toggle matSuffix [for]="p2"></mat-datepicker-toggle><mat-datepicker #p2></mat-datepicker></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>Currency</mat-label><mat-select formControlName="currency"><mat-option value="INR">INR</mat-option></mat-select></mat-form-field>
        <div class="toggle-box"><mat-slide-toggle color="primary" formControlName="isActive">Active Status</mat-slide-toggle></div>
      </div>
      <div class="full-width-field mt-3">
        <mat-form-field appearance="outline" class="w-100"><mat-label>Remarks</mat-label><textarea matInput formControlName="remarks" rows="2"></textarea></mat-form-field>
      </div>
    </div>

    <div class="table-section-card mt-4 shadow-sm">
      <div class="p-3 border-bottom d-flex justify-content-between align-items-center bg-light">
        <h6 class="m-0 fw-bold"><mat-icon class="me-2 text-primary">inventory_2</mat-icon> Linked Products</h6>
        <button type="button" mat-raised-button color="primary" (click)="addItemRow()"><mat-icon>add</mat-icon> Add Product</button>
      </div>

      <div class="table-responsive-box">
        <div formArrayName="priceListItems" class="horizontal-scroll-force">
          <table class="enterprise-table">
            <thead>
              <tr>
                <th class="col-search">PRODUCT DETAILS</th>
                <th class="col-uom">UNIT</th>
                <th class="col-min">MIN QTY</th>
                <th class="col-max">MAX QTY</th>
                <th class="col-price">RATE (â‚¹)</th>
                <th class="col-disc">DISC (%)</th>
                <th class="col-action">ACTION</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of items.controls; let i = index" [formGroupName]="i">
                <td class="col-search">
                  <mat-form-field appearance="outline" class="w-100 no-subscript">
                    <input type="text" matInput placeholder="Search..." formControlName="productSearch" [matAutocomplete]="auto">
                    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                      <mat-option *ngFor="let prod of filteredProducts[i]" [value]="prod">{{prod.name}}</mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </td>
                <td class="col-uom"><input type="text" class="table-control text-center" formControlName="unit" readonly></td>
                <td class="col-min"><input type="number" class="table-control text-center" formControlName="minQty"></td>
                <td class="col-max"><input type="number" class="table-control text-center" formControlName="maxQty"></td>
                <td class="col-price"><input type="number" class="table-control text-end text-success fw-bold" formControlName="rate"></td>
                <td class="col-disc"><input type="number" class="table-control text-center" formControlName="discountPercent"></td>
                <td class="col-action">
                  <button type="button" mat-icon-button color="warn" (click)="removeItem(i)" [disabled]="items.length === 1">
                    <mat-icon>delete_outline</mat-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </form>
</div>